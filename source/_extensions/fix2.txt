def get_effective_schema(schema, data):
    """
    Resolves 'oneOf' by matching data against 'const' requirements.
    Handles both direct values and wrapped { 'value': ... } items.
    """
    if 'oneOf' not in schema:
        return schema

    for option in schema['oneOf']:
        match = True
        if 'properties' in option:
            for prop, prop_def in option['properties'].items():
                # Only check if the property has a 'const' requirement
                if 'const' in prop_def and prop in data:
                    
                    # --- UNWRAP LOGIC ---
                    actual_val = data[prop]
                    if isinstance(actual_val, dict) and 'value' in actual_val:
                        actual_val = actual_val['value']
                    # --------------------

                    if actual_val != prop_def['const']:
                        match = False
                        break
        
        # If all 'const' requirements in this option match the data, return it
        if match:
            return option
            
    return schema
