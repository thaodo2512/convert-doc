{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Numeric Sensor Initialization PDR (DSP0248 Type 3)",
  "description": "Per DSP0248 v1.3.0 Clause 28.5 and DSP0240 v1.2.0 Section 2.5",
  "type": "object",
  "additionalProperties": false,
  "binaryOrder": [
    "pdrHeader",
    "PLDMTerminusHandle",
    "sensorID",
    "initConditions",
    "sensorEnable",
    "thresholdInitMask",
    "sensorDataSize",
    "upperThresholdWarning",
    "upperThresholdCritical",
    "upperThresholdFatal",
    "lowerThresholdWarning",
    "lowerThresholdCritical",
    "lowerThresholdFatal"
  ],
  "x-c-struct-packing": 1,
  "properties": {
    "pdrHeader": {
      "type": "object",
      "description": "Common PDR Header (DSP0248)",
      "additionalProperties": false,
      "binaryOrder": [
        "recordHandle",
        "PDRHeaderVersion",
        "PDRType",
        "recordChangeNumber",
        "dataLength"
      ],
      "properties": {
        "recordHandle": {
          "oneOf": [
            { "type": "string", "enum": ["auto"] },
            { "type": "integer", "minimum": 0, "maximum": 4294967295 }
          ],
          "binaryFormat": "I",
          "description": "uint32; PDR Record Handle. 0 = auto-assign."
        },
        "PDRHeaderVersion": {
          "type": "integer",
          "const": 1,
          "binaryFormat": "B",
          "description": "uint8; PDR Header Version (1)"
        },
        "PDRType": {
          "type": "integer",
          "const": 3,
          "binaryFormat": "B",
          "description": "uint8; PDR Type 3 = Numeric Sensor Initialization"
        },
        "recordChangeNumber": {
          "type": "integer",
          "default": 0,
          "binaryFormat": "H",
          "description": "uint16; recordChangeNumber"
        },
        "dataLength": {
          "oneOf": [
            { "type": "string", "enum": ["auto"] },
            { "type": "integer", "minimum": 0 }
          ],
          "binaryFormat": "H",
          "description": "uint16; Length of data following this header (calculated automatically)."
        }
      },
      "required": ["recordHandle", "PDRHeaderVersion", "PDRType", "recordChangeNumber", "dataLength"]
    },
    "PLDMTerminusHandle": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; PLDM Terminus Handle"
    },
    "sensorID": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; Sensor ID"
    },
    "initConditions": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "bitfield8; Conditions for initialization: [7:5] reserved, [4] PLDM terminus online, [3] system warm reset, [2] system hard reset, [1] PLDM subsystem power up, [0] Initialization Agent restart/update"
    },
    "sensorEnable": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "enum8; Operational state after init, special 0xFF = do not change"
    },
    "thresholdInitMask": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "bitfield8; Thresholds to initialize: [7:6] reserved, [5] lowerFatal, [4] lowerCritical, [3] lowerWarning, [2] upperFatal, [1] upperCritical, [0] upperWarning"
    },
    "sensorDataSize": {
      "type": "integer",
      "minimum": 0,
      "maximum": 7,
      "binaryFormat": "B",
      "description": "enum8; 0=uint8, 1=sint8, 2=uint16, 3=sint16, 4=uint32, 5=sint32, 6=uint64, 7=sint64"
    },
    "upperThresholdWarning": {
      "type": "integer",
      "description": "Upper warning threshold in raw units. Present if thresholdInitMask bit 0 set.",
      "x-binary-condition": { "field": "thresholdInitMask", "mask": 1 },
      "x-binary-format": { "ref": "sensorDataSize", "map": { "0": "B", "1": "b", "2": "H", "3": "h", "4": "I", "5": "i", "6": "Q", "7": "q" } }
    },
    "upperThresholdCritical": {
      "type": "integer",
      "description": "Upper critical threshold in raw units. Present if thresholdInitMask bit 1 set.",
      "x-binary-condition": { "field": "thresholdInitMask", "mask": 2 },
      "x-binary-format": { "ref": "sensorDataSize", "map": { "0": "B", "1": "b", "2": "H", "3": "h", "4": "I", "5": "i", "6": "Q", "7": "q" } }
    },
    "upperThresholdFatal": {
      "type": "integer",
      "description": "Upper fatal threshold in raw units. Present if thresholdInitMask bit 2 set.",
      "x-binary-condition": { "field": "thresholdInitMask", "mask": 4 },
      "x-binary-format": { "ref": "sensorDataSize", "map": { "0": "B", "1": "b", "2": "H", "3": "h", "4": "I", "5": "i", "6": "Q", "7": "q" } }
    },
    "lowerThresholdWarning": {
      "type": "integer",
      "description": "Lower warning threshold in raw units. Present if thresholdInitMask bit 3 set.",
      "x-binary-condition": { "field": "thresholdInitMask", "mask": 8 },
      "x-binary-format": { "ref": "sensorDataSize", "map": { "0": "B", "1": "b", "2": "H", "3": "h", "4": "I", "5": "i", "6": "Q", "7": "q" } }
    },
    "lowerThresholdCritical": {
      "type": "integer",
      "description": "Lower critical threshold in raw units. Present if thresholdInitMask bit 4 set.",
      "x-binary-condition": { "field": "thresholdInitMask", "mask": 16 },
      "x-binary-format": { "ref": "sensorDataSize", "map": { "0": "B", "1": "b", "2": "H", "3": "h", "4": "I", "5": "i", "6": "Q", "7": "q" } }
    },
    "lowerThresholdFatal": {
      "type": "integer",
      "description": "Lower fatal threshold in raw units. Present if thresholdInitMask bit 5 set.",
      "x-binary-condition": { "field": "thresholdInitMask", "mask": 32 },
      "x-binary-format": { "ref": "sensorDataSize", "map": { "0": "B", "1": "b", "2": "H", "3": "h", "4": "I", "5": "i", "6": "Q", "7": "q" } }
    }
  },
  "required": [
    "pdrHeader",
    "PLDMTerminusHandle",
    "sensorID",
    "initConditions",
    "sensorEnable",
    "thresholdInitMask",
    "sensorDataSize"
  ]
}
