{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Compact Numeric Sensor PDR (DSP0248 Type 21)",
  "description": "Per DSP0248 v1.3.0 Clause 28.25 and DSP0240 v1.2.0 Section 2.5",
  "type": "object",
  "additionalProperties": false,
  "binaryOrder": [
    "pdrHeader",
    "PLDMTerminusHandle",
    "sensorID",
    "entityType",
    "entityInstanceNumber",
    "containerID",
    "sensorNameStringByteLength",
    "baseUnit",
    "unitModifier",
    "rateUnit",
    "rangeFieldSupport",
    "warningHigh",
    "warningLow",
    "criticalHigh",
    "criticalLow",
    "fatalHigh",
    "fatalLow",
    "sensorNameString"
  ],
  "x-c-struct-packing": 1,
  "properties": {
    "pdrHeader": {
      "type": "object",
      "description": "Common PDR Header (DSP0248)",
      "additionalProperties": false,
      "binaryOrder": [
        "recordHandle",
        "PDRHeaderVersion",
        "PDRType",
        "recordChangeNumber",
        "dataLength"
      ],
      "properties": {
        "recordHandle": {
          "oneOf": [
            { "type": "string", "enum": ["auto"] },
            { "type": "integer", "minimum": 0, "maximum": 4294967295 }
          ],
          "binaryFormat": "I",
          "description": "uint32; PDR Record Handle. 0 = auto-assign."
        },
        "PDRHeaderVersion": {
          "type": "integer",
          "const": 1,
          "binaryFormat": "B",
          "description": "uint8; PDR Header Version (1)"
        },
        "PDRType": {
          "type": "integer",
          "const": 21,
          "binaryFormat": "B",
          "description": "uint8; PDR Type 21 = Compact Numeric Sensor"
        },
        "recordChangeNumber": {
          "type": "integer",
          "default": 0,
          "binaryFormat": "H",
          "description": "uint16; recordChangeNumber"
        },
        "dataLength": {
          "oneOf": [
            { "type": "string", "enum": ["auto"] },
            { "type": "integer", "minimum": 0 }
          ],
          "binaryFormat": "H",
          "description": "uint16; Length of data following this header (calculated automatically)."
        }
      },
      "required": ["recordHandle", "PDRHeaderVersion", "PDRType", "recordChangeNumber", "dataLength"]
    },
    "PLDMTerminusHandle": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; PLDM Terminus Handle"
    },
    "sensorID": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; Sensor ID"
    },
    "entityType": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; Entity Type"
    },
    "entityInstanceNumber": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; Entity Instance Number"
    },
    "containerID": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; Container ID"
    },
    "sensorNameStringByteLength": {
      "type": "integer",
      "minimum": 0,
      "maximum": 96,
      "binaryFormat": "B",
      "description": "uint8; If >0, 'sensorNameString' must be provided. Recommended max 96."
    },
    "baseUnit": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "enum8; Base Unit (see Table 75)"
    },
    "unitModifier": {
      "type": "integer",
      "minimum": -128,
      "maximum": 127,
      "binaryFormat": "b",
      "description": "sint8; Unit Modifier"
    },
    "rateUnit": {
      "type": "integer",
      "minimum": 0,
      "maximum": 9,
      "binaryFormat": "B",
      "description": "enum8; Rate Unit: 0=None,1=Per Î¼s,2=Per ms,3=Per s,4=Per min,5=Per hour,6=Per day,7=Per week,8=Per month,9=Per year"
    },
    "rangeFieldSupport": {
      "type": "integer",
      "minimum": 0,
      "maximum": 63,
      "binaryFormat": "B",
      "description": "bitfield8; Supported thresholds: bit0=warningHigh, bit1=warningLow, bit2=criticalHigh, bit3=criticalLow, bit4=fatalHigh, bit5=fatalLow (bits6-7 reserved). Provide corresponding fields only if bit set."
    },
    "warningHigh": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "description": "sint32; Warning High threshold (provide only if rangeFieldSupport bit0=1)"
    },
    "warningLow": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "description": "sint32; Warning Low threshold (provide only if rangeFieldSupport bit1=1)"
    },
    "criticalHigh": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "description": "sint32; Critical High threshold (provide only if rangeFieldSupport bit2=1)"
    },
    "criticalLow": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "description": "sint32; Critical Low threshold (provide only if rangeFieldSupport bit3=1)"
    },
    "fatalHigh": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "description": "sint32; Fatal High threshold (provide only if rangeFieldSupport bit4=1)"
    },
    "fatalLow": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "description": "sint32; Fatal Low threshold (provide only if rangeFieldSupport bit5=1)"
    },
    "sensorNameString": {
      "type": "string",
      "description": "strUTF-8; Vendor-defined display name (no terminator). Byte length must exactly match sensorNameStringByteLength. Provide only if sensorNameStringByteLength > 0.",
      "binaryFormat": "variable",
      "x-binary-encoding": "utf-8",
      "x-binary-terminator": "none",
      "x-binary-length-ref": "sensorNameStringByteLength",
      "maxLength": 96
    }
  },
  "required": [
    "pdrHeader",
    "PLDMTerminusHandle",
    "sensorID",
    "entityType",
    "entityInstanceNumber",
    "containerID",
    "sensorNameStringByteLength",
    "baseUnit",
    "unitModifier",
    "rateUnit",
    "rangeFieldSupport"
  ],
  "allOf": [
    {
      "if": {
        "properties": { "sensorNameStringByteLength": { "minimum": 1 } }
      },
      "then": {
        "required": ["sensorNameString"]
      }
    }
  ]
}
