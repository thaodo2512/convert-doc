{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Terminus Locator PDR (DSP0248 Type 1)",
  "description": "Per DSP0248 v1.3.0 Clause 28.3 and DSP0240 v1.2.0 Section 2.5",
  "type": "object",
  "additionalProperties": false,
  "binaryOrder": [
    "pdrHeader",
    "PLDMTerminusHandle",
    "validity",
    "TID",
    "containerID",
    "locator"
  ],
  "x-c-struct-packing": 1,
  "properties": {
    "pdrHeader": {
      "type": "object",
      "description": "Common PDR Header (DSP0248)",
      "additionalProperties": false,
      "binaryOrder": [
        "recordHandle",
        "PDRHeaderVersion",
        "PDRType",
        "recordChangeNumber",
        "dataLength"
      ],
      "properties": {
        "recordHandle": {
          "oneOf": [
            { "type": "string", "enum": ["auto"] },
            { "type": "integer", "minimum": 0, "maximum": 4294967295 }
          ],
          "binaryFormat": "I",
          "description": "uint32; PDR Record Handle. 0 = auto-assign."
        },
        "PDRHeaderVersion": {
          "type": "integer",
          "const": 1,
          "binaryFormat": "B",
          "description": "uint8; PDR Header Version (1)"
        },
        "PDRType": {
          "type": "integer",
          "const": 1,
          "binaryFormat": "B",
          "description": "uint8; PDR Type 1 = Terminus Locator"
        },
        "recordChangeNumber": {
          "type": "integer",
          "default": 0,
          "binaryFormat": "H",
          "description": "uint16; recordChangeNumber"
        },
        "dataLength": {
          "oneOf": [
            { "type": "string", "enum": ["auto"] },
            { "type": "integer", "minimum": 0 }
          ],
          "binaryFormat": "H",
          "description": "uint16; Length of data following this header (calculated automatically)."
        }
      },
      "required": ["recordHandle", "PDRHeaderVersion", "PDRType", "recordChangeNumber", "dataLength"]
    },
    "PLDMTerminusHandle": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; A handle that identifies PDRs that belong to a particular PLDM terminus."
    },
    "validity": {
      "type": "integer",
      "enum": [0, 1],
      "binaryFormat": "B",
      "description": "uint8; 0=notValid (ignore PDR), 1=valid"
    },
    "TID": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "uint8; PLDM Terminus ID used to identify asynchronous messages from this terminus."
    },
    "containerID": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; The containerID for the containing entity that holds this terminus. See 9.1 for more information."
    },
    "locator": {
      "type": "object",
      "description": "Terminus locator details, polymorphic based on type.",
      "oneOf": [
        {
          "title": "UID (Type 0)",
          "additionalProperties": false,
          "binaryOrder": [
            "terminusLocatorType",
            "terminusLocatorValueSize",
            "terminusInstance",
            "deviceUID"
          ],
          "properties": {
            "terminusLocatorType": {
              "type": "integer",
              "const": 0,
              "binaryFormat": "B"
            },
            "terminusLocatorValueSize": {
              "type": "integer",
              "const": 17,
              "binaryFormat": "B"
            },
            "terminusInstance": {
              "type": "integer",
              "minimum": 0,
              "maximum": 255,
              "binaryFormat": "B",
              "description": "uint8; Differentiates multiple PLDM termini in the same device."
            },
            "deviceUID": {
              "type": "array",
              "minItems": 16,
              "maxItems": 16,
              "items": {
                "type": "integer",
                "minimum": 0,
                "maximum": 255,
                "binaryFormat": "B"
              },
              "description": "16-byte UUID binary."
            }
          },
          "required": ["terminusLocatorType", "terminusLocatorValueSize", "terminusInstance", "deviceUID"]
        },
        {
          "title": "MCTP_EID (Type 1)",
          "additionalProperties": false,
          "binaryOrder": [
            "terminusLocatorType",
            "terminusLocatorValueSize",
            "EID"
          ],
          "properties": {
            "terminusLocatorType": {
              "type": "integer",
              "const": 1,
              "binaryFormat": "B"
            },
            "terminusLocatorValueSize": {
              "type": "integer",
              "const": 1,
              "binaryFormat": "B"
            },
            "EID": {
              "type": "integer",
              "minimum": 0,
              "maximum": 255,
              "binaryFormat": "B",
              "description": "uint8; MCTP Endpoint ID."
            }
          },
          "required": ["terminusLocatorType", "terminusLocatorValueSize", "EID"]
        },
        {
          "title": "SMBusRelative (Type 2)",
          "additionalProperties": false,
          "binaryOrder": [
            "terminusLocatorType",
            "terminusLocatorValueSize",
            "UID",
            "busNumber",
            "slaveAddress"
          ],
          "properties": {
            "terminusLocatorType": {
              "type": "integer",
              "const": 2,
              "binaryFormat": "B"
            },
            "terminusLocatorValueSize": {
              "type": "integer",
              "const": 18,
              "binaryFormat": "B"
            },
            "UID": {
              "type": "array",
              "minItems": 16,
              "maxItems": 16,
              "items": {
                "type": "integer",
                "minimum": 0,
                "maximum": 255,
                "binaryFormat": "B"
              },
              "description": "16-byte UID of the controller owning the bus."
            },
            "busNumber": {
              "type": "integer",
              "minimum": 0,
              "maximum": 255,
              "binaryFormat": "B",
              "description": "uint8; Relative bus number or MCTP port."
            },
            "slaveAddress": {
              "type": "integer",
              "minimum": 0,
              "maximum": 255,
              "binaryFormat": "B",
              "description": "uint8; Bits [7:1] slave address, [0]=0b."
            }
          },
          "required": ["terminusLocatorType", "terminusLocatorValueSize", "UID", "busNumber", "slaveAddress"]
        },
        {
          "title": "systemSoftware (Type 3)",
          "additionalProperties": false,
          "binaryOrder": [
            "terminusLocatorType",
            "terminusLocatorValueSize",
            "softwareClass",
            "UUID"
          ],
          "properties": {
            "terminusLocatorType": {
              "type": "integer",
              "const": 3,
              "binaryFormat": "B"
            },
            "terminusLocatorValueSize": {
              "type": "integer",
              "const": 17,
              "binaryFormat": "B"
            },
            "softwareClass": {
              "type": "integer",
              "enum": [0, 1, 2, 3, 4, 5, 6, 7],
              "binaryFormat": "B",
              "description": "uint8; 0=unspecified, 1=other, 2=systemFirmware, 3=OSloader, 4=OS, 5=CIMprovider, 6=otherProvider, 7=virtualMachineManager"
            },
            "UUID": {
              "type": "array",
              "minItems": 16,
              "maxItems": 16,
              "items": {
                "type": "integer",
                "minimum": 0,
                "maximum": 255,
                "binaryFormat": "B"
              },
              "description": "16-byte unique identifier for the software instance."
            }
          },
          "required": ["terminusLocatorType", "terminusLocatorValueSize", "softwareClass", "UUID"]
        },
        {
          "title": "NC_SI (Type 4)",
          "additionalProperties": false,
          "binaryOrder": [
            "terminusLocatorType",
            "terminusLocatorValueSize"
          ],
          "properties": {
            "terminusLocatorType": {
              "type": "integer",
              "const": 4,
              "binaryFormat": "B"
            },
            "terminusLocatorValueSize": {
              "type": "integer",
              "const": 0,
              "binaryFormat": "B"
            }
          },
          "required": ["terminusLocatorType", "terminusLocatorValueSize"]
        }
      ]
    }
  },
  "required": [
    "pdrHeader",
    "PLDMTerminusHandle",
    "validity",
    "TID",
    "containerID",
    "locator"
  ]
}
