{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "File Descriptor PDR (DSP0248 Type 30)",
  "description": "Per DSP0248 v1.3.0 Clause 28.30 and DSP0240 v1.2.0 Section 2.5",
  "type": "object",
  "additionalProperties": false,
  "binaryOrder": [
    "pdrHeader",
    "PLDMTerminusHandle",
    "FileIdentifier",
    "EntityType",
    "EntityInstanceNumber",
    "ContainerID",
    "SuperiorDirectoryFileIdentifier",
    "FileClassification",
    "OemFileClassification",
    "FileCapabilities",
    "FileVersion",
    "FileMaximumSize",
    "FileMaximumFileDescriptorCount",
    "FileNameLength",
    "FileName",
    "OemFileClassificationNameLength",
    "OemFileClassificationName"
  ],
  "x-c-struct-packing": 1,
  "properties": {
    "pdrHeader": {
      "type": "object",
      "description": "Common PDR Header (DSP0248)",
      "additionalProperties": false,
      "binaryOrder": [
        "recordHandle",
        "PDRHeaderVersion",
        "PDRType",
        "recordChangeNumber",
        "dataLength"
      ],
      "properties": {
        "recordHandle": {
          "oneOf": [
            { "type": "string", "enum": ["auto"] },
            { "type": "integer", "minimum": 0, "maximum": 4294967295 }
          ],
          "binaryFormat": "I",
          "description": "uint32; PDR Record Handle. 0 = auto-assign."
        },
        "PDRHeaderVersion": {
          "type": "integer",
          "const": 1,
          "binaryFormat": "B",
          "description": "uint8; PDR Header Version (1)"
        },
        "PDRType": {
          "type": "integer",
          "const": 30,
          "binaryFormat": "B",
          "description": "uint8; PDR Type 30 = File Descriptor"
        },
        "recordChangeNumber": {
          "type": "integer",
          "default": 0,
          "binaryFormat": "H",
          "description": "uint16; recordChangeNumber"
        },
        "dataLength": {
          "oneOf": [
            { "type": "string", "enum": ["auto"] },
            { "type": "integer", "minimum": 0 }
          ],
          "binaryFormat": "H",
          "description": "uint16; Length of data following this header (calculated automatically)."
        }
      },
      "required": ["recordHandle", "PDRHeaderVersion", "PDRType", "recordChangeNumber", "dataLength"]
    },
    "PLDMTerminusHandle": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; A handle that identifies PDRs that belong to a particular PLDM terminus."
    },
    "FileIdentifier": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; A unique numeric file identifier relative to the given PLDM Terminus ID."
    },
    "EntityType": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; The Type value for the entity that is associated with this file or directory. Shall be Device File (9 physical, 32777 logical) or Device File Directory (10 physical, 32778 logical). See DSP0249 for Entity IDs."
    },
    "EntityInstanceNumber": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; The Instance Number for the entity that is associated with this file or directory. Every file within a ContainerID shall have a unique EntityInstanceNumber."
    },
    "ContainerID": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; The containerID for the containing entity that instantiates the entity that is measured by this sensor."
    },
    "SuperiorDirectoryFileIdentifier": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; The FileIdentifier of the parent directory PDR (EntityType = Device File Directory). Special: 0x0000 = not used (use EAR), 0xFFFF = top level or not in hierarchy."
    },
    "FileClassification": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "enum8; File classification: 0=OEM, 1=BootLog, 2=SerialTxFIFO, 3=SerialRxFIFO, 4=DiagnosticLog, 5=CrashDumpFile, 6=SecurityLog, 7=FRUDataFile, 8=TelemetryDataFile, 9=TelemetryDataLog, 0xFD=OtherLog, 0xFE=OtherFile, 0xFF=FileDirectory. If OEM, OemFileClassification !=0."
    },
    "OemFileClassification": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "enum8; OEM Specific classification. 0 = none. Must not be 0 if FileClassification=0 (OEM)."
    },
    "FileCapabilities": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "bitfield16; File capabilities bits: [0]=ExReadOpen, [1]=ExWriteOpen, [2]=FileTrunc, [3]=DataType, [4]=Polled, [5]=Pushed, [6]=DataVolatility, [7]=FileModify, [8]=FcZeroLengthPermitted, [9]=FcWritesPermitted, [10-15]=Reserved."
    },
    "FileVersion": {
      "type": "object",
      "additionalProperties": false,
      "binaryOrder": [
        "major",
        "minor",
        "update",
        "alpha"
      ],
      "properties": {
        "major": {
          "type": "integer",
          "minimum": 0,
          "maximum": 255,
          "binaryFormat": "B",
          "description": "uint8; Major version number"
        },
        "minor": {
          "type": "integer",
          "minimum": 0,
          "maximum": 255,
          "binaryFormat": "B",
          "description": "uint8; Minor version number"
        },
        "update": {
          "type": "integer",
          "minimum": 0,
          "maximum": 255,
          "binaryFormat": "B",
          "description": "uint8; Update number"
        },
        "alpha": {
          "type": "integer",
          "minimum": 0,
          "maximum": 255,
          "binaryFormat": "B",
          "description": "uint8; Alpha number (0=not alpha)"
        }
      },
      "required": [
        "major",
        "minor",
        "update",
        "alpha"
      ],
      "description": "ver32; All 255 for unversioned file or directory."
    },
    "FileMaximumSize": {
      "type": "integer",
      "minimum": 0,
      "maximum": 4294967295,
      "binaryFormat": "I",
      "description": "uint32; Maximum size in bytes before truncation/wrapping. 0xFFFFFFFF = unlimited or for directories."
    },
    "FileMaximumFileDescriptorCount": {
      "type": "integer",
      "minimum": 1,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "uint8; Maximum number of open file descriptors (min 1)."
    },
    "FileNameLength": {
      "type": "integer",
      "minimum": 1,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "uint8; Length of FileName including NULL terminator."
    },
    "FileName": {
      "type": "string",
      "description": "strASCII per DSP0240. Null-terminated (0x00). Includes terminator in length. Unique file name for the device.",
      "binaryFormat": "variable",
      "x-binary-encoding": "us-ascii",
      "x-binary-terminator": "0x00",
      "maxLength": 255
    },
    "OemFileClassificationNameLength": {
      "type": "integer",
      "minimum": 1,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "uint8; Length of OemFileClassificationName including NULL terminator. Present if OemFileClassification !=0."
    },
    "OemFileClassificationName": {
      "type": "string",
      "description": "strASCII per DSP0240. Null-terminated (0x00). Includes terminator in length. Present if OemFileClassification !=0.",
      "binaryFormat": "variable",
      "x-binary-encoding": "us-ascii",
      "x-binary-terminator": "0x00",
      "maxLength": 255
    }
  },
  "required": [
    "pdrHeader",
    "PLDMTerminusHandle",
    "FileIdentifier",
    "EntityType",
    "EntityInstanceNumber",
    "ContainerID",
    "SuperiorDirectoryFileIdentifier",
    "FileClassification",
    "OemFileClassification",
    "FileCapabilities",
    "FileVersion",
    "FileMaximumSize",
    "FileMaximumFileDescriptorCount",
    "FileNameLength",
    "FileName"
  ],
  "if": {
    "properties": {
      "OemFileClassification": {
        "not": {
          "const": 0
        }
      }
    }
  },
  "then": {
    "required": [
      "OemFileClassificationNameLength",
      "OemFileClassificationName"
    ]
  }
}
